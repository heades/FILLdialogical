\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage{amssymb,amsmath,amsthm}
\usepackage{cmll}
\usepackage{stmaryrd}
\usepackage{todonotes}
\usepackage{mathpartir}
\usepackage{fullpage}

\include{type-theory_inc}

\title{Cut-elimination of the APAL term assignment formulation of FILL}
\author{Harley Eades III}
\date{September 2014}

%\usepackage{natbib}
%\usepackage{graphicx}

% Ott includes.
\usepackage{color}
\usepackage{supertabular}
\input{FILL-ott}

\begin{document}

\maketitle

In this short note I give the proof of the term assignment formulation
of FILL first given in \cite{Hyland:1993}.

\section{The Fix}
\label{sec:the_fix}
Consider the $\FILLdrulename{Dparl}$ rule in the dependency-relation
formalization:
\begin{center}
  \begin{math}
    \begin{array}{lll}
      \FILLdruleDparl{}
      && Dep(\tau) = \{([[A (+) B]], [[A]]), ([[A (+) B]], [[B]])\}
      \star (Dep(\tau_1) \cup Dep(\tau_2))
    \end{array}
  \end{math}
\end{center}
If anything in $[[L1]]$ and $[[L2]]$ depend on $[[A]]$ or $[[B]]$ then
this will be accounted for in $Dep(\tau_1)$ and $Dep(\tau_2)$.  Thus,
in the term formalization when binding pattern variables across the
righthand side of the sequent we should do so if and only if there is
a dependency.  In fact, if a formula on the righthand side depends on
a formula in the lefthand side, then the variable associated with
that hypnosis must be free in the term associated with the formula on
the right.  This evidence suggests that to fix the term formalization
we must modify the $\FILLdrulename{Parl}$ rule.

The new $\FILLdrulename{Parl}$ rule as follows:
\[
\FILLdruleNParl{}
\]
The previous rule depends on a function which we define as follows:
\begin{center}
  \begin{math}
    \begin{array}{lll}      
      [[let-pat z (x (+) -) e]] = [[e]]\\
      \,\,\,\,\,\,\text{where } [[x]] \not\in \mathsf{FV}([[e]])\\
      & \\
      [[let-pat z (- (+) y) e]] = [[e]]\\
      \,\,\,\,\,\,\text{where } [[y]] \not\in \mathsf{FV}([[e]])\\
      & \\
      [[let-pat z p e]] = [[let z be p in e]]\\
    \end{array}
  \end{math}
\end{center}
Note that in the definition of $[[let-pat z p e]]$ the final case is a
catchall case.  Now the new $\FILLdrulename{Parl}$ rule only pattern
matches on $[[z]]$ in the righthand side if there is a dependency
between the variables in the pattern and the term in the pattern
match.  A similar rule to the above was proposed by Bellin in the
conclusion of \cite{Bierman:1996}.

This rule recovers from the counterexample.  The first derivation
given in the counter example above is unchanged, so we only give the
second:
\begin{center}
  \footnotesize
  \begin{math}    
    $$\mprset{flushleft}
    \inferrule* [right=\tiny Impr] {
      $$\mprset{flushleft}
      \inferrule* [right=\tiny Parr] {
        $$\mprset{flushleft}
        \inferrule* [right=\tiny Parl] {
          $$\mprset{flushleft}
          \inferrule* [right=\tiny Cut] {      
            $$\mprset{flushleft}
            \inferrule* [right=\tiny Pr] {
              $$\mprset{flushleft}
              \inferrule* [right=\tiny Ax] {
                \,
              }{[[v : A |- v : A]]}
            }{[[v : A |- v : A | o : _|_]]}
            \\
            $$\mprset{flushleft}
            \inferrule* [right=\tiny Tr] {
              $$\mprset{flushleft}
              \inferrule* [right=\tiny Ax] {
                \,
              }{[[x : A |- x : A]]}
              \\
              $$\mprset{flushleft}
              \inferrule* [right=\tiny Ax] {
                \,
              }{[[y : B |- y : B]]}
            }{[[x : A, y : B |- x (x) y : A (x) B]]}
          }{[[y:B, v : A |- v (x) y: A (x) B | o : _|_]]}          
          \\
          $$\mprset{flushleft}
          \inferrule* [right=\tiny Ax] {
            \,
          }{[[w : C |- w : C]]}
        }{[[v:A,cb{z}:B(+)C |- h(h{let cb{z} be y (+) - in h{v (x) y}} : A (x) B | h{let cb{z} be - (+) w in w} : C) | o : _|_]]}                   
      }{[[v:A,cb{z}:B(+)C |- {{let cb{z} be y (+) - in h{v (x) y}} (+) {let cb{z} be - (+) w in w}} : (A (x) B) (+) C | o : _|_]]}      
    }{[[v:A |- \z.{{let z be y (+) - in h{v (x) y}} (+) {let z be - (+) w in w}} : (B(+)C) -o ((A (x) B) (+) C) | o : _|_]]}
  \end{math}
\end{center}
This new derivation is now correct, and mirrors that of the
dependency-relation formalization.
% section the_fix (end)

\section{Basic Results}
\label{sec:basic_results}
\begin{lemma}[Substitution Distribution]
  \label{lemma:substitution_distribution}
  For any terms $[[t]]$, $[[t1]]$, and $[[t2]]$, $[[ [t1/x][t2/y]t]] = [[ [ [t1/x]t2/y][t2/x]t]]$.
\end{lemma}
\begin{proof}
  This proof holds by straightforward induction on the form of $t$.
\end{proof}

% section basic_results (end)


\section{Cut-elimination}
\label{sec:cut-elimination}

\subsection{Commuting conversion cut vs cut (first case)}
\label{subsec:commuting_conversion_cut_vs_cut_(first_case)}
The following proof
\begin{center}
  \begin{math}
    $$\mprset{flushleft}
    \inferrule* [right=Cut] {
      $$\mprset{flushleft}
      \inferrule* [right=] {
        \inferrule* [right=,vdots=1.5em,fraction=\,] {
          \,
        }{\pi_1}
      }{[[G |- t : A | L]]}
      \\
      $$\mprset{flushleft}
      \inferrule* [right=Cut] {
        $$\mprset{flushleft}
        \inferrule* [right=] {
          \inferrule* [right=,vdots=1.5em,fraction=\,] {
            \,
          }{\pi_2}
        }{[[G2,x : A,G3 |- t1 : B | L1]]}
        \\
        $$\mprset{flushleft}
        \inferrule* [right=] {
          \inferrule* [right=,vdots=1.5em,fraction=\,] {
            \,
          }{\pi_3}
        }{[[G1,y : B,G4 |- t2 : C | L2]]}
      }{[[G1,G2,x : A,G3,G4 |- h(L1 | [t1/y]t2 : C) | [t1/y]L2]]}
    }{[[G1,G2,G,G3,G4 |- h(h(L | [t/x]L1) | h{[t/x][t1/y]t2} : C) | [t/x]h([t1/y]L2)]]}
  \end{math}
\end{center}
is transformed into the proof
\begin{center}
  \begin{math}
    $$\mprset{flushleft}
    \inferrule* [right=Cut] {
      $$\mprset{flushleft}
      \inferrule* [right=] {
        $$\mprset{flushleft}
      \inferrule* [right=] {
        \inferrule* [right=,vdots=1.5em,fraction=\,] {
          \,
        }{\pi_1}               
      }{[[G |- t : A | L]]}
      \\
      $$\mprset{flushleft}
        \inferrule* [right=] {
          \inferrule* [right=,vdots=1.5em,fraction=\,] {
            \,
          }{\pi_2}
        }{[[G2,x : A,G3 |- t1 : B | L1]]}
      }{[[G2,G,G3 |- h{[t/x]t1} : B | [t/x]L1]]}
      \\
      $$\mprset{flushleft}
        \inferrule* [right=] {
          \inferrule* [right=,vdots=1.5em,fraction=\,] {
            \,
          }{\pi_3}
        }{[[G1,y : B,G4 |- t2 : C | L2]]}
    }{[[G1,G2,G,G3,G4 |- h(h(L | [t/x]L1) | {[ [t/x]t1/y]t2} : C) | [ [t/x]t1/y]L2]]}
  \end{math}
\end{center}
In order for the previous two proofs to be considered equal, we have
to show that the final terms in the conclusion of the above
derivations are equivalent. First, we know that the term $[[
[t/x][t1/y]t2]]$ in the first derivation above is equivalent to $[[ [
[t/x] t1/y][t/x] t2]]$ by Lemma~\ref{lemma:substitution_distribution}.
Furthermore, by inspecting the first derivation we can see that $[[x
nin FV(t2)]]$, and thus, $[[ [ [t/x] t1/y][t/x] t2 = [ [t/x] t1/y]
t2]]$.  This argument may be repeated for any term in $[[L2]]$, and
thus, we know $[[ [t/x][t1/y]L2 = [ [t/x]t1/y]L2]]$.
% subsection commuting_conversion_cut_vs_cut_(first_case) (end)

\subsection{Commuting conversion cut vs. cut (second case)}
\label{subsec:commuting_conversion_cut_vs._cut_(second_case)}
The second commuting conversion on cut begins with the proof
\begin{center}
  \begin{math}
    $$\mprset{flushleft}
    \inferrule* [right=Cut] {
      $$\mprset{flushleft}
      \inferrule* [right=] {
        \inferrule* [right=,vdots=1.5em,fraction=\,] {
          \,
        }{\pi_1}
      }{[[G |- t : A | L]]}
      \\
      $$\mprset{flushleft}
      \inferrule* [right=Cut] {
        $$\mprset{flushleft}
        \inferrule* [right=] {
          \inferrule* [right=,vdots=1.5em,fraction=\,] {
            \,
          }{\pi_2}
        }{[[G' |- t' : B | L']]}
        \\
        $$\mprset{flushleft}
        \inferrule* [right=] {
          \inferrule* [right=,vdots=1.5em,fraction=\,] {
            \,
          }{\pi_3}
        }{[[G1,x : A,G2,y:B,G3 |- t1 : C | L1]]}
      }{[[G1,x : A,G2,G',G3 |- h(L' | [t'/y]t1 : C) | [t'/y]L1]]}
    }{[[G1,G,G2,G',G3 |- h(h(L | [t/x]L') | h{[t/x][t'/y]t1} : C) | [t/x]h([t'/y]L1)]]}
  \end{math}
\end{center}
is transformed into the following proof:
\begin{center}
  \begin{math}
    $$\mprset{flushleft}
    \inferrule* [right=\text{\scriptsize Series of Exchanges}] {
      $$\mprset{flushleft}
    \inferrule* [right=Cut] {
      $$\mprset{flushleft}
      \inferrule* [right=] {
        \inferrule* [right=,vdots=1.5em,fraction=\,] {
          \,
        }{\pi_2}
      }{[[G' |- t' : B | L']]}
      \\
      $$\mprset{flushleft}
      \inferrule* [right=Cut] {
        $$\mprset{flushleft}
        \inferrule* [right=] {
          \inferrule* [right=,vdots=1.5em,fraction=\,] {
            \,
          }{\pi_1}
        }{[[G |- t : A | L]]}      
        \\
        $$\mprset{flushleft}
        \inferrule* [right=] {
          \inferrule* [right=,vdots=1.5em,fraction=\,] {
            \,
          }{\pi_3}
        }{[[G1,x : A,G2,y:B,G3 |- t1 : C | L1]]}
      }{[[G1,G,G2,y:B,G3 |- h(L | [t/x]t1 : C) | [t/x]L1]]}
    }{[[G1,G,G2,G',G3 |- h(h(L' | [t'/y]L) | h{[t'/y][t/x]t1} : C) | [t'/y]h([t/x]L1)]]}
    }{[[G1,G,G2,G',G3 |- h(h(h([t'/y]L) | L') | h{[t'/y][t/x]t1} : C) | [t'/y]h([t/x]L1)]]}
  \end{math}
\end{center}
Now, because we know $[[x,y nin FV(L)]]$ by inspection of the first
derivation, we know that $[[L = [t'/y]L]]$ and $[[L' = [t/x]L']]$.
Similarly, we know that $[[x,y nin FV(t)]]$ and $[[x,y nin FV(t')]]$.
Thus, by this fact and Lemma~\ref{lemma:substitution_distribution}, we
know that $[[ [t/x][t'/y]t1 = [ [t/x]t'/y][t/x]t1]] = [[ [t'/y][t/x]t1
]]$.  This argument can be repeated for any term in $[[L1]]$, hence,
$[[ [t/x][t'/y]L1 = [t'/y][t/x]L1]]$.  Therefore, both of the previous
derivations are equivalent.
% subsection commuting_conversion_cut_vs._cut_(second_case) (end)

\subsection{The $\eta$-expansion cases}
\label{subsec:eta-expansion_cases}

\subsubsection{Tensor}
\label{subsec:tensor}
The proof
\begin{center}
  \begin{math}
    $$\mprset{flushleft}
    \inferrule* [right=Ax] {
      \,
    }{[[x : A (x) B |- x : A (x) B]]}
  \end{math}
\end{center}
is transformed into the proof
\begin{center}
  \begin{math}
    $$\mprset{flushleft}
    \inferrule* [right=Tl] {
      $$\mprset{flushleft}
      \inferrule* [right=Tr] {
        $$\mprset{flushleft}
        \inferrule* [right=Ax] {
          \,
        }{[[y : A |- y : A]]}
        \\
        $$\mprset{flushleft}
        \inferrule* [right=Ax] {
          \,
        }{[[z : B |- z : B]]}
      }{[[y : A, z : B |- y (x) z : A (x) B]]}
    }{[[x : A (x) B |- h{let x be y (x) z in {y (x) z}} : A (x) B]]}
  \end{math}
\end{center}
Now by the rule $\FILLdrulename{EQ\_T2}$ we know $[[let x be y (x) z
in {y (x) z} = x]]$.
% subsubsection tensor (end)

\subsubsection{Par}
\label{subsec:par}
The proof
\begin{center}
  \begin{math}
    $$\mprset{flushleft}
    \inferrule* [right=Ax] {
      \,
    }{[[x : A (+) B |- x : A (+) B]]}
  \end{math}
\end{center}
is transformed into the proof
\begin{center}
  \begin{math}
    $$\mprset{flushleft}
    \inferrule* [right=Parr] {
      $$\mprset{flushleft}
      \inferrule* [right=Parl] {
        $$\mprset{flushleft}
        \inferrule* [right=Ax] {
          \,
        }{[[y : A |- y : A]]}
        \\
        $$\mprset{flushleft}
        \inferrule* [right=Ax] {
          \,
        }{[[z : B |- z : B]]}
      }{[[x : A (+) B |- h{let x be (y (+) -) in y} : A | h{let x be (- (+) z) in z} : B]]}
    }{[[x : A (+) B |- {let x be (y (+) -) in y} (+) {let x be (- (+) z) in z} : A (+) B]]}
  \end{math}
\end{center}
Just as we saw in the previous case by rule $\FILLdrulename{Eq\_P3}$
we know $[[{{let x be (y (+) -) in y} (+) {let x be (- (+) z) in z}} =
x]]$.
% subsubsection par (end)

\subsubsection{Implication}
\label{subsec:implication}
The proof
\begin{center}
  \begin{math}
    $$\mprset{flushleft}
    \inferrule* [right=Ax] {
      \,
    }{[[x : A -o B |- A -o B]]}
  \end{math}
\end{center}
transforms into the proof 
\begin{center}
  \begin{math}
    $$\mprset{flushleft}
    \inferrule* [right=ImpR] {
      $$\mprset{flushleft}
      \inferrule* [right=ImpL] {
        $$\mprset{flushleft}
        \inferrule* [right=Ax] {
          \,
        }{[[y : A |- y : A]]}
        \\
        $$\mprset{flushleft}
        \inferrule* [right=Ax] {
          \,
        }{z : B |- z : B}
      }{[[y : A, x : A -o B |- x y : B]]}
    }{[[x : A -o B |- \y.h{x y} : A -o B]]}
  \end{math}  
\end{center}
Finally, the two derivations are equivalent, because $[[{\y.h{x y}} =
x]]$ by the $\FILLdrulename{Eq\_Eta}$ rule.
% subsubsection implication (end)

\subsubsection{Tensor unit}
\label{subsec:tensor_unit}
The proof
\begin{center}
  \begin{math}
    $$\mprset{flushleft}
    \inferrule* [right=Ax] {
      \,
    }{[[x : I |- x : I]]}
  \end{math}
\end{center}
transforms into the proof
\begin{center}
  \begin{math}
    $$\mprset{flushleft}
    \inferrule* [right=Il] {
      $$\mprset{flushleft}
      \inferrule* [right=Ir] {
        \,
      }{[[. |- * : I]]}
    }{[[x : I |- h{let x be stp in *} : I]]}
  \end{math}
\end{center}
Lastly, we know $[[x = let x be stp in *]]$ by
$\FILLdrulename{Eq\_I}$, therefore, the previous two proofs are
equivalent.
% subsubsection tensor_unit (end)
% subsection eta-expansion_cases (end)

\section{The axiom steps}
\label{sec:the_axiom_steps}
\subsection{The axiom step}
\label{subsec:the_axiom_step}
The proof 
\begin{center}
  \begin{math}
    $$\mprset{flushleft}
    \inferrule* [right=Cut] {
      $$\mprset{flushleft}
      \inferrule* [right=Ax] {
        \,
      }{[[x : A |- x : A]]}
      \\
      $$\mprset{flushleft}
      \inferrule* [right=] {
        \inferrule* [right=,vdots=1.5em,fraction=\,] {
            \,
          }{\pi}          
      }{[[G1,y : A, G2 |- t : B | L]]}
    }{[[G1,x : A, G2 |- h{[x/y]t} : B | [x/y]L]]}
  \end{math}
\end{center}
transforms into the proof
\begin{center}
  \begin{math}
    $$\mprset{flushleft}
      \inferrule* [right=] {
        \inferrule* [right=,vdots=1.5em,fraction=\,] {
            \,
          }{\pi}          
      }{[[G1,y : A, G2 |- t : B | L]]}
  \end{math}
\end{center}
By $\FILLdrulename{Eq\_Alpha}$ we know $[[t = [x/y]t]]$ and $[[L = [x/y]L]]$, therefore the
previous two proofs are equivalent.
% subsection the_axiom_step (end)

\subsection{Conclusion vs. axom}
\label{subsec:conclusion_vs._axom}
The proof 
\begin{center}
  \begin{math}
    $$\mprset{flushleft}
    \inferrule* [right=Cut] {
      $$\mprset{flushleft}
      \inferrule* [right=] {
        \inferrule* [right=,vdots=1.5em,fraction=\,] {
            \,
          }{\pi}          
      }{[[G |- t : A | L]]}
      \,
      $$\mprset{flushleft}
      \inferrule* [right=Ax] {
        \,
      }{[[x : A |- x : A]]}
    }{[[G |- L | h{[t/x]x} : A]]}
  \end{math}
\end{center}
transforms into 
\begin{center}
  \begin{math}
    $$\mprset{flushleft}
    \inferrule* [right=\text{\tiny Series of Exchanges}] {
      \inferrule* [right=] {
        \inferrule* [right=,vdots=1.5em,fraction=\,] {
            \,
          }{\pi}          
      }{[[G |- t : A | L]]}
    }{[[G |- L | t : A ]]}
  \end{math}
\end{center}
By the definition of the substitution function we know $[[t =
[t/x]x]]$. Therefore, the previous two proofs are equivalent.
% subsection conclusion_vs._axom (end)
% section the_axiom_steps (end)

\subsection{The exchange steps}
\label{subsec:the_exchange_steps}
\subsubsection{Conclusion vs. left-exchange (the first case)}
\label{subsec:conclusion_vs._exchange_(the_first_case)}
The proof
\begin{center}
  \begin{math}
    $$\mprset{flushleft}
    \inferrule* [right=Cut] {
      \inferrule* [right=] {
        \inferrule* [right=,vdots=1.5em,fraction=\,] {
            \,
          }{\pi_1}          
      }{[[G |- t : A | L]]}
      \\
      $$\mprset{flushleft}
      \inferrule* [right=Exl] {        
        $$\mprset{flushleft}
        \inferrule* [right=] {
          \inferrule* [right=,vdots=1.5em,fraction=\,] {
            \,
          }{\pi_2}          
        }{[[G1,x : A, y : B, G2 |- t' : C | L']]}        
      }{[[G1,y : B,x : A, G2 |- t' : C | L']]}
    }{[[G1,y : B,G, G2 |- h(L | h{[t/x]t'} : C) | [t/x]L']]}
  \end{math}
\end{center}
transforms into the proof
\begin{center}
  \begin{math}
    $$\mprset{flushleft}
    \inferrule* [right=\text{Series of Exchanges}] {
      $$\mprset{flushleft}
      \inferrule* [right=Cut] {
        \inferrule* [right=] {
        \inferrule* [right=,vdots=1.5em,fraction=\,] {
            \,
          }{\pi_1}          
      }{[[G |- t : A | L]]}
      \\
        $$\mprset{flushleft}
        \inferrule* [right=] {
          \inferrule* [right=,vdots=1.5em,fraction=\,] {
            \,
          }{\pi_2}          
        }{[[G1,x : A, y : B, G2 |- t' : C | L']]}        
      }{[[G1,G,y : B, G2 |- h(L | h{[t/x]t'} : C) | [t/x]L']]}
    }{[[G1,y : B,G, G2 |- h(L | h{[t/x]t'} : C) | [t/x]L']]}
  \end{math}
\end{center}
Clearly, all terms are equivalent, and so the previous two proofs are
equivalent.
% subsubsection conclusion_vs._exchange_(the_first_case) (end)

\subsubsection{Conclusion vs. left-exchange (the second case)}
\label{subsec:conclusion_vs._exchange_(the_second_case)}
The proof
\begin{center}
  \begin{math}
    $$\mprset{flushleft}
    \inferrule* [right=Cut] {
      \inferrule* [right=] {
        \inferrule* [right=,vdots=1.5em,fraction=\,] {
            \,
          }{\pi_1}          
      }{[[G |- t : B | L]]}
      \\
      $$\mprset{flushleft}
      \inferrule* [right=Exl] {        
        $$\mprset{flushleft}
        \inferrule* [right=] {
          \inferrule* [right=,vdots=1.5em,fraction=\,] {
            \,
          }{\pi_2}          
        }{[[G1,x : A, y : B, G2 |- t' : C | L']]}        
      }{[[G1,y : B,x : A, G2 |- t' : C | L']]}
    }{[[G1,G, x : A,G2 |- h(L | h{[t/y]t'} : C) | [t/y]L']]}
  \end{math}
\end{center}
transforms into the proof
\begin{center}
  \begin{math}
    $$\mprset{flushleft}
    \inferrule* [right=\text{Series of Exchanges}] {
      $$\mprset{flushleft}
      \inferrule* [right=Cut] {
        \inferrule* [right=] {
        \inferrule* [right=,vdots=1.5em,fraction=\,] {
            \,
          }{\pi_1}          
      }{[[G |- t : B | L]]}
      \\
        $$\mprset{flushleft}
        \inferrule* [right=] {
          \inferrule* [right=,vdots=1.5em,fraction=\,] {
            \,
          }{\pi_2}          
        }{[[G1,x : A, y : B, G2 |- t' : C | L']]}        
      }{[[G1,x : A,G,G2 |- h(L | h{[t/y]t'} : C) | [t/y]L']]}
    }{[[G1,G,x : A,G2 |- h(L | h{[t/y]t'} : C) | [t/y]L']]}
  \end{math}
\end{center}
Clearly, all terms are equivalent, and so the previous two proofs are
equivalent.
% subsubsection conclusion_vs._exchange_(the_second_case) (end)

\subsubsection{Conclusion vs. right-exchange}
\label{subsec:conclusion_vs._right-exchange}
The proof
\begin{center}
  \begin{math}
    $$\mprset{flushleft}
    \inferrule* [right=Cut] {
        \inferrule* [right=] {
        \inferrule* [right=,vdots=1.5em,fraction=\,] {
            \,
          }{\pi_1}          
      }{[[G |- t : A | L]]}
      \\
      $$\mprset{flushleft}
      \inferrule* [right=Exr] {
        $$\mprset{flushleft}
        \inferrule* [right=] {
          \inferrule* [right=,vdots=1.5em,fraction=\,] {
            \,
          }{\pi_2}          
        }{[[G1,x : A, G2 |- h(h(L1 | t1 : B) | t2 : C) | L']]}        
      }{[[G1,x : A, G2 |- h(h(L1 | t2 : C) | t1 : B) | L']]}
    }{[[G1,G,G2 |- L | h(h(h(h([t/x]L1) | h{[t/x]t2} : C) | h{[t/x]t1} : B) | [t/x]L')]]}
  \end{math}
\end{center}
transforms into this proof
\begin{center}
  \begin{math}
    $$\mprset{flushleft}
    \inferrule* [right=Exr] {
      $$\mprset{flushleft}
      \inferrule* [right=Cut] {
        \inferrule* [right=] {
        \inferrule* [right=,vdots=1.5em,fraction=\,] {
            \,
          }{\pi_1}          
      }{[[G |- t : A | L]]}
      \\
      $$\mprset{flushleft}
        \inferrule* [right=] {
          \inferrule* [right=,vdots=1.5em,fraction=\,] {
            \,
          }{\pi_2}          
        }{[[G1,x : A, G2 |- h(h(L1 | t1 : B) | t2 : C) | L']]}        
      }{[[G1,G, G2 |- L | h(h(h(h([t/x]L1) | h{[t/x]t1} : B) | h{[t/x]t2} : C) | [t/x]L')]]}
    }{[[G1,G, G2 |- h(h(h([t/x]L1) | h{[t/x]t2} : C) | h{[t/x]t1} : B) | [t/x]L']]}
  \end{math}
\end{center}
% subsubsection conclusion_vs._right-exchange_(the_first_case) (end)
% subsection the_exchange_steps (end)

\subsection{Principle formula vs. principle formula}
\label{subsec:principle_formula_vs._principle_formula}

\subsubsection{Tensor}
\label{subsec:tensor}
The proof 
\begin{center}
  \footnotesize
  \begin{math}
    $$\mprset{flushleft}
    \inferrule* [right=\footnotesize Cut] {
      $$\mprset{flushleft}
      \inferrule* [right=\footnotesize Tr] {
        \inferrule* [right=] {
        \inferrule* [right=,vdots=1.5em,fraction=\,] {
            \,
          }{\pi_1}          
      }{[[G1 |- t1 : A | L1]]}
      \\
      \inferrule* [right=] {
        \inferrule* [right=,vdots=1.5em,fraction=\,] {
            \,
          }{\pi_2}          
      }{[[G2 |- t2 : B | L2]]}
      }{[[G1,G2 |- t1 (x) t2 : A (x) B | h(L1 | L2)]]}
      \\
      $$\mprset{flushleft}
      \inferrule* [right=\footnotesize Tl] {
        \inferrule* [right=] {
          \inferrule* [right=,vdots=1.5em,fraction=\,] {
            \,
          }{\pi_3}          
        }{[[G3,x : A, y : B,G4 |- t3 : C | L3]]}
      }{[[G3,z : A (x) B,G4 |- h{let z be x (x) y in t3} : C | h(let z be x (x) y in L3)]]}
    }{[[G3,G1,G2,G4 |- h(L1 | L2) | h(h{[t1 (x) t2/z]{let z be x (x) y in t3}} : C | [t1 (x) t2/z](h(let z be x (x) y in L3)))]]}
  \end{math}
\end{center}
is transformed into the proof
\begin{center}
  \begin{math}
    $$\mprset{flushleft}
    \inferrule* [right=Cut] {
      \inferrule* [right=] {
        \inferrule* [right=,vdots=1.5em,fraction=\,] {
            \,
          }{\pi_1}          
      }{[[G1 |- t1 : A | L1]]}
      \\
      $$\mprset{flushleft}
      \inferrule* [right=Cut] {
        \inferrule* [right=] {
        \inferrule* [right=,vdots=1.5em,fraction=\,] {
            \,
          }{\pi_2}          
      }{[[G2 |- t2 : B | L2]]}
      \\
      \inferrule* [right=] {
          \inferrule* [right=,vdots=1.5em,fraction=\,] {
            \,
          }{\pi_3}          
        }{[[G3,x : A, y : B,G4 |- t3 : C | L3]]}
      }{[[G3,x : A, G2,G4 |- L2 | h(h{[t2/y]t3} : C | [t2/y]L3)]]}
    }{[[G3,G1, G2,G4 |- h(L1 | L2) | h(h{[t1/x][t2/y]t3} : C | [t1/x][t2/y]L3)]]}
  \end{math}
\end{center}
Now we can see that 
$[[h{[t1 (x) t2/z]{let z be x (x) y in t3}} = let t1 (x) t2 be x (x) y in t3]]$ 
by the definition of substitution, and by using the $\FILLdrulename{Eq\_T1}$ rule 
we obtain $[[let t1 (x) t2 be x (x) y in t3 = [t1/x][t2/y]t3]]$.  This argument
can be repeated for any term in $[[ [t1 (x) t2/z](h(let z be x (x) y in L3))]]$, and
thus, $[[ [t1 (x) t2/z](h(let z be x (x) y in L3)) = [t1/x][t2/y]L3]]$. Therefore, the
previous two proofs are equivalent.

Note that in the second derivation of the above transformation we
first cut on $[[B]]$, and then $[[A]]$, but we could have cut on
$[[A]]$ first, and then $[[B]]$, but this would yeild equivalent
derivations as above by using
Lemma~\ref{lemma:substitution_distribution}.
% subsubsection tensor (end)

\subsubsection{Par}
\label{subsec:par}
The proof
\begin{center}
  \scriptsize
  \begin{math}
    $$\mprset{flushleft}
\inferrule* [right=\scriptsize Cut] {
  $$\mprset{flushleft}
  \inferrule* [right=\scriptsize Parr] {
    \inferrule* [right=] {
        \inferrule* [right=,vdots=1.5em,fraction=\,] {
            \,
          }{\pi_1}          
      }{[[G1 |- h(L1 | t1 : A) | h(t2 : B | L2)]]}
    }{[[G1 |- h(L1 | t1 (+) t2 : A (+) B) | L2]]}
  \\
  $$\mprset{flushleft}
  \inferrule* [right=\scriptsize Parl] {
    \inferrule* [right=] {
        \inferrule* [right=,vdots=1.5em,fraction=\,] {
            \,
          }{\pi_2}          
      }{[[G2,x : A |- t3 : C1 | L3]]}
      \\
      \inferrule* [right=] {
        \inferrule* [right=,vdots=1.5em,fraction=\,] {
            \,
          }{\pi_3}          
      }{[[G3, y : B |- t4 : C2 | L4]]}
  }{[[G2,G3,z : A (+) B |- h(h{let-pat z (x (+) -) t3} : C1 | h{let-pat z (- (+) y) t4} : C2) | L5]]}
}{[[G2,G3,G1 |- h(L1 | L2) | h(h(h{[t1 (+) t2/z]{let-pat z (x (+) -) t3}} : C1 | h{[t1 (+) t2/z]{let-pat z (- (+) y) t4}} : C2) | h([t1 (+) t2/z]L5))]]}
  \end{math}
\end{center}
where $[[L4]] = [[h(h(let-pat z (x (+) -) L3), h(let-pat z (- (+) y) L4))]]$ is transformed into the proof
\begin{center}
  \begin{math}
    $$\mprset{flushleft}
    \inferrule* [right=\tiny Series of Exr] {
      $$\mprset{flushleft}
    \inferrule* [right=Cut] {
      $$\mprset{flushleft}
      \inferrule* [right=Cut] {
        \inferrule* [right=] {
          \inferrule* [right=,vdots=1.5em,fraction=\,] {
            \,
          }{\pi_1}          
        }{[[G1 |- h(L1 | t1 : A) | h(t2 : B | L2)]]}
        \\
        \inferrule* [right=] {
          \inferrule* [right=,vdots=1.5em,fraction=\,] {
            \,
          }{\pi_3}          
        }{[[G3, y : B |- t4 : C2 | L4]]}
      }{[[G3, G1 |- h(h(L1 | t1 : A) | L2) | h(h{[t2/y]t4} : C2 | [t2/y]L4)]]}
      \\
      \inferrule* [right=] {
        \inferrule* [right=,vdots=1.5em,fraction=\,] {
          \,
        }{\pi_2}          
      }{[[G2,x : A |- t3 : C1 | L3]]}
    }{[[G2,G3,G1 |- h(h(L1 | L2) | h(h{[t2/y]t4} : C2 | [t2/y]L4)) | h(h{[t1/x]t3} : C1 | [t1/x]L3)]]}
    }{[[G2,G3,G1 |- h(h(L1 | L2) | h{[t1/x]t3} : C1) | h(h{[t2/y]t4} : C2 | h(h([t1/x]L3) | [t2/y]L4))]]}
  \end{math}
\end{center}
First, $[[ [t1 (+) t2/z]{let-pat z (x (+) -) t3} = let-pat {t1 (+) t2}
(x (+) -) t3]]$, and $[[let-pat {t1 (+) t2} (x (+) -) t3 = [t1/x]t3]]$
if $[[x in FV(t3)]]$ or $[[let-pat {t1 (+) t2} (x (+) -) t3 = t3]]$ otherwise.
In the latter case we can see that $[[t3 = [t1/x]t3]]$, thus, in both cases
$[[let-pat {t1 (+) t2} (x (+) -) t3 = [t1/x]t3]]$.  This argument can be repeated for any terms in $[[L3]]$,
and hence, $[[ [t1 (+) t2/z](let-pat z (x (+) -) L3)]] = [[let-pat {t1 (+) t2} (x (+) -) L3 = [t1/x]L3]]$.
We can apply a similar argument for $[[ [t1 (+) t2/z]{let-pat z (- (+) y) t4}]]$ and 
$[[ [t1 (+) t2/x](let-pat z (- (+) y) L4)]]$.  Thus, all terms in the previous derivations are equivalent, 
and therefore, the previous proofs are equivalent.

Note that just as we mentioned about tensor we could have first cut on
$[[A]]$, and then on $[[B]]$ in the second derivation, but we would
have arrived as the same result just with potentially more exchanges
on the right.
% subsubsection par (end)



% subsection principle_formula_vs._principle_formula (end)



% section cut-elimination (end)


\bibliographystyle{plain}
\bibliography{ref}

\appendix

\section{The full specification of FILL}
\label{sec:fill_specification}
\FILLall{}
% section the_full_fill_specification (end)


\end{document}

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: t
%%% End: 